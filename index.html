<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Form Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Modern Animations */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px) scale(0.95); } 
            to { opacity: 1; transform: translateY(0) scale(1); } 
        }
        
        .slide-in { animation: slideIn 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes slideIn { 
            from { opacity: 0; transform: translateX(-30px); } 
            to { opacity: 1; transform: translateX(0); } 
        }
        
                 .pulse-glow { animation: pulseGlow 3s ease-in-out infinite; }
         @keyframes pulseGlow { 
             0%, 100% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.4); } 
             50% { box-shadow: 0 0 50px rgba(59, 130, 246, 0.8), 0 0 80px rgba(147, 51, 234, 0.4); } 
         }
        
        .float { animation: float 6s ease-in-out infinite; }
        @keyframes float { 
            0%, 100% { transform: translateY(0px); } 
            50% { transform: translateY(-10px); } 
        }
        
        .shimmer { animation: shimmer 2s linear infinite; }
        @keyframes shimmer { 
            0% { background-position: -200% 0; } 
            100% { background-position: 200% 0; } 
        }
        
                 /* Advanced Gradients */
         .gradient-bg { 
             background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #7c3aed 100%);
             background-size: 200% 200%;
             animation: gradientShift 20s ease infinite;
             min-height: 100vh;
             overflow-x: hidden;
             overflow-y: auto;
         }
        @keyframes gradientShift { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }
        
                 .glass { 
             backdrop-filter: blur(20px) saturate(180%);
             background: rgba(255, 255, 255, 0.12);
             border: 1px solid rgba(255, 255, 255, 0.2);
             box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
         }
        
        .glass-dark { 
            backdrop-filter: blur(20px) saturate(180%);
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
                 /* Enhanced Buttons */
         .btn-glow:hover { 
             box-shadow: 0 0 30px rgba(59, 130, 246, 0.6), 0 0 60px rgba(147, 51, 234, 0.3);
             transform: translateY(-3px) scale(1.02);
             transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
         }
        
        .btn-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            background-size: 200% 100%;
            animation: shimmer 3s linear infinite;
        }
        
                 /* Card Effects */
         .card-hover:hover { 
             transform: translateY(-8px) scale(1.02);
             box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15), 0 0 30px rgba(59, 130, 246, 0.2);
             transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
         }
        
                 /* Input Styling */
         .input-glow:focus {
             box-shadow: 0 0 20px rgba(59, 130, 246, 0.4), 0 0 40px rgba(147, 51, 234, 0.2);
             transform: scale(1.02);
             transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
         }
        
        /* Particle Effect */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: particleFloat 30s linear infinite;
        }
        
        @keyframes particleFloat {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(180deg); opacity: 0; }
        }
        
        /* Subtle Text Glow */
        .text-glow {
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }
        
        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
                 /* Responsive Design */
         @media (max-width: 768px) {
             .container { padding: 1rem; }
             .text-5xl { font-size: 2.5rem; }
             .text-2xl { font-size: 1.5rem; }
             
             /* Mobile-specific optimizations */
             .glass { 
                 backdrop-filter: blur(15px) saturate(150%);
                 background: rgba(255, 255, 255, 0.15);
                 border: 1px solid rgba(255, 255, 255, 0.25);
             }
             
             /* Larger touch targets */
             button, input, select, textarea {
                 min-height: 44px;
                 font-size: 16px !important; /* Prevents zoom on iOS */
             }
             
                      /* Mobile-friendly spacing */
         .mb-8 { margin-bottom: 1.5rem; }
         .p-8 { padding: 1.5rem; }
         .px-6 { padding-left: 1rem; padding-right: 1rem; }
         .py-4 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
         
         /* Touch-friendly interactions */
         button, input, select, textarea {
             -webkit-tap-highlight-color: transparent;
             touch-action: manipulation;
         }
         
         /* Prevent text selection on buttons */
         button {
             -webkit-user-select: none;
             -moz-user-select: none;
             -ms-user-select: none;
             user-select: none;
         }
             
             /* Stack buttons vertically on mobile */
             .flex.space-x-4 {
                 flex-direction: column;
                 gap: 0.75rem;
             }
             
             /* Mobile modal adjustments */
             .glass-dark {
                 margin: 1rem;
                 padding: 1.5rem;
                 max-width: calc(100vw - 2rem);
             }
         }
         
         /* Extra small devices */
         @media (max-width: 480px) {
             .text-5xl { font-size: 2rem; }
             .text-4xl { font-size: 1.75rem; }
             .text-3xl { font-size: 1.5rem; }
             
             .container { padding: 0.5rem; }
             
             /* Compact mobile layout */
             .p-8 { padding: 1rem; }
             .mb-8 { margin-bottom: 1rem; }
             
             /* Single column grid on very small screens */
             .grid.grid-cols-1.md\\:grid-cols-3 {
                 grid-template-columns: 1fr;
             }
         }
         
         /* Fix scrolling issues */
         body {
             overflow-x: hidden;
             overflow-y: auto;
             scroll-behavior: smooth;
             min-height: 100vh;
             -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
         }
         
         html {
             scroll-behavior: smooth;
             height: 100%;
         }
         
         /* Dropdown styling */
         select option {
             background-color: #1f2937 !important;
             color: white !important;
             padding: 8px 12px;
         }
         
         select option:hover {
             background-color: #374151 !important;
         }
         
         select option:checked {
             background-color: #3b82f6 !important;
         }
    </style>
</head>
 <body class="min-h-screen gradient-bg relative">
    <!-- Particle Background -->
    <div class="particles" id="particles"></div>
    
         <div class="container mx-auto px-4 py-8 max-w-6xl relative z-10">
        <div class="text-center mb-12 fade-in">
            <div class="mb-8">
                <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mx-auto flex items-center justify-center shadow-lg mb-4">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
            </div>
            <h1 class="text-5xl font-bold text-white mb-4">Form Builder Pro</h1>
            <p class="text-xl text-white/80 max-w-2xl mx-auto leading-relaxed mb-6">Create professional Google Forms with AI assistance</p>
            <div class="flex justify-center space-x-6">
                <div class="flex items-center space-x-2 text-white/70">
                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                    <span class="text-sm">AI-Powered</span>
                </div>
                <div class="flex items-center space-x-2 text-white/70">
                    <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                    <span class="text-sm">Real-time Preview</span>
                </div>
                <div class="flex items-center space-x-2 text-white/70">
                    <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                    <span class="text-sm">Instant Creation</span>
                </div>
            </div>
        </div>

        <div id="formContainer" class="flex justify-center">
            <div class="w-full max-w-2xl" id="mainFormSection">
                <div class="glass rounded-3xl p-8 card-hover transition-all duration-300 slide-in">
                <div class="flex items-center mb-8">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center mr-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <h2 class="text-3xl font-bold text-white">Form Configuration</h2>
                </div>
                
                <div class="mb-8">
                    <label class="block text-white font-semibold mb-3 text-lg">üéØ Form Title</label>
                    <input type="text" id="formTitle" placeholder="Enter your form title..." class="w-full px-6 py-4 rounded-2xl bg-white/10 text-white placeholder-white/60 border border-white/20 focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400/50 transition-all input-glow text-lg">
                </div>

                <div class="mb-8">
                    <label class="block text-white font-semibold mb-3 text-lg">‚ùì Question Text</label>
                    <div class="flex gap-4 mb-4">
                        <input type="text" id="questionText" placeholder="Enter your question..." class="flex-1 px-6 py-4 rounded-2xl bg-white/10 text-white placeholder-white/60 border border-white/20 focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400/50 transition-all input-glow text-lg">
                        <button onclick="showCSVImportModal()" class="px-6 py-4 bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-2xl hover:from-green-600 hover:to-teal-700 transition-all btn-glow font-semibold text-lg shadow-lg">üìÅ Import CSV</button>
                    </div>
                    <div id="csvImportPreview" class="hidden mt-4 p-4 bg-white/10 rounded-2xl border border-white/20">
                        <h4 class="text-white font-semibold mb-2">üìã Imported Questions:</h4>
                        <div id="importedQuestionsList" class="max-h-32 overflow-y-auto space-y-2"></div>
                        <button onclick="importQuestionsFromCSV()" class="mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all btn-glow font-semibold">‚úÖ Import All Questions</button>
                    </div>
                </div>

                <div class="mb-8">
                    <label class="block text-white font-semibold mb-3 text-lg">üìã Question Type</label>
                                         <select id="questionType" class="w-full px-6 py-4 rounded-2xl bg-white/10 text-white border border-white/20 focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400/50 transition-all input-glow text-lg">
                         <option value="Short Answer" class="bg-gray-800 text-white">Short Answer</option>
                         <option value="Paragraph" class="bg-gray-800 text-white">Paragraph</option>
                         <option value="Multiple Choice" class="bg-gray-800 text-white">Multiple Choice</option>
                         <option value="Checkboxes" class="bg-gray-800 text-white">Checkboxes</option>
                         <option value="Dropdown" class="bg-gray-800 text-white">Dropdown</option>
                     </select>
                </div>

                <div id="optionsSection" class="mb-8 hidden">
                    <label class="block text-white font-semibold mb-4 text-lg">‚öôÔ∏è Options Configuration</label>
                    <div class="space-y-4">
                        <div class="grid grid-cols-3 gap-3">
                            <button onclick="setOptionMethod('manual')" id="manualBtn" class="px-6 py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-2xl hover:from-blue-600 hover:to-blue-700 transition-all btn-glow font-semibold text-lg shadow-lg">‚úèÔ∏è Manual</button>
                            <button onclick="setOptionMethod('csv')" id="csvBtn" class="px-6 py-4 bg-white/20 text-white rounded-2xl hover:bg-white/30 transition-all font-semibold text-lg shadow-lg">üìÅ Upload CSV</button>
                            <button onclick="setOptionMethod('ai')" id="aiBtn" class="px-6 py-4 bg-white/20 text-white rounded-2xl hover:bg-white/30 transition-all font-semibold text-lg shadow-lg">ü§ñ AI Generate</button>
                        </div>
                        
                        <div id="manualOptions">
                            <textarea id="optionsText" placeholder="Option 1&#10;Option 2&#10;Option 3" class="w-full px-6 py-4 rounded-2xl bg-white/10 text-white placeholder-white/60 border border-white/20 focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400/50 transition-all h-40 text-lg input-glow resize-none"></textarea>
                        </div>
                        
                        <div id="csvOptions" class="hidden">
                            <div class="border-2 border-dashed border-white/30 rounded-2xl p-8 text-center hover:border-white/50 transition-all">
                                <input type="file" id="csvFile" accept=".csv" class="w-full h-full absolute inset-0 opacity-0 cursor-pointer">
                                <div class="text-white/80">
                                    <svg class="w-12 h-12 mx-auto mb-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    <p class="text-lg font-semibold">Drop your CSV file here</p>
                                    <p class="text-sm opacity-75">or click to browse</p>
                                </div>
                            </div>
                        </div>
                        
                        <div id="aiOptions" class="hidden">
                                                     <div class="flex flex-col sm:flex-row gap-4">
                             <input type="number" id="numOptions" value="4" min="2" max="10" class="flex-1 px-6 py-4 rounded-2xl bg-white/10 text-white border border-white/20 focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400/50 transition-all text-lg input-glow">
                             <button onclick="generateAIOptions()" class="px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl hover:from-purple-600 hover:to-pink-600 transition-all btn-glow font-semibold text-lg shadow-lg">üöÄ Generate</button>
                         </div>
                            <div id="aiOptionsResult" class="mt-4 hidden"></div>
                        </div>
                    </div>
                </div>

                <div id="paragraphSection" class="mb-8 hidden">
                    <label class="block text-white font-semibold mb-4 text-lg">üí° AI Example Answers</label>
                                             <div class="flex flex-col sm:flex-row gap-4">
                             <input type="number" id="numExamples" value="3" min="1" max="10" class="flex-1 px-6 py-4 rounded-2xl bg-white/10 text-white border border-white/20 focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400/50 transition-all text-lg input-glow">
                             <button onclick="generateAIExamples()" class="px-8 py-4 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-2xl hover:from-green-600 hover:to-blue-600 transition-all btn-glow font-semibold text-lg shadow-lg">‚ú® Generate Examples</button>
                         </div>
                    <div id="aiExamplesResult" class="mt-4 hidden"></div>
                </div>

                <div class="mb-8">
                    <button onclick="showAIGenerationModal()" class="w-full px-8 py-6 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 text-white rounded-2xl hover:from-purple-600 hover:via-pink-600 hover:to-red-600 transition-all btn-glow font-bold text-xl shadow-2xl mb-6 btn-shimmer">ü§ñ Generate Form with AI</button>
                </div>
                
                                 <div class="flex flex-col sm:flex-row gap-4">
                     <button onclick="addQuestion()" class="flex-1 px-8 py-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl hover:from-blue-600 hover:to-purple-700 transition-all btn-glow font-bold text-lg shadow-lg">‚ûï Add Question</button>
                     <button onclick="clearForm()" class="px-8 py-6 bg-white/20 text-white rounded-2xl hover:bg-white/30 transition-all font-bold text-lg shadow-lg">üóëÔ∏è Clear</button>
                 </div>
            </div>
        </div>

        <div id="formPreviewSection" class="glass rounded-3xl p-8 card-hover transition-all duration-300 slide-in hidden">
            <div class="flex items-center mb-8">
                <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-teal-600 rounded-xl flex items-center justify-center mr-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold text-white">Questions List</h2>
            </div>
            
            <div id="questionsPreview" class="space-y-4 mb-8">
                <div class="text-white/70 text-center py-12">
                    <div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <p class="text-lg font-semibold">No questions added yet</p>
                    <p class="text-sm opacity-75">Add your first question to see the list!</p>
                </div>
            </div>
            
            <div id="createFormSection" class="hidden">
                <div class="flex flex-col sm:flex-row gap-4 mb-6">
                    <button onclick="showAIGenerationModal()" class="flex-1 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl hover:from-purple-600 hover:to-pink-600 transition-all btn-glow font-bold text-lg shadow-lg">ü§ñ Add More Questions</button>
                    <button onclick="createGoogleForm()" id="createFormBtn" class="flex-1 px-6 py-4 bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-2xl hover:from-green-600 hover:to-teal-700 transition-all btn-glow font-bold text-lg pulse-glow shadow-2xl">üöÄ Create Google Form</button>
                </div>
            </div>
        </div>

        <div id="loadingModal" class="fixed inset-0 bg-black/60 backdrop-blur-md hidden items-center justify-center z-50">
            <div class="glass-dark rounded-3xl p-12 max-w-md mx-4">
                <div class="text-center">
                    <div class="spinner mx-auto mb-6"></div>
                    <h3 class="text-2xl font-bold text-white mb-4 text-glow">Creating Your Form...</h3>
                    <p class="text-white/80 text-lg">Please wait while we generate your Google Form</p>
                    <div class="mt-6 flex justify-center space-x-2">
                        <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                        <div class="w-2 h-2 bg-pink-400 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                    </div>
                </div>
            </div>
        </div>

                 <div id="successModal" class="fixed inset-0 bg-black/60 backdrop-blur-md hidden items-center justify-center z-50">
             <div class="glass-dark rounded-3xl p-12 max-w-md mx-4">
                 <div class="text-center">
                     <div class="w-20 h-20 bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl">
                         <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                         </svg>
                     </div>
                     <h3 class="text-3xl font-bold text-white mb-6 text-glow">Form Created Successfully!</h3>
                     <a id="formLink" href="#" target="_blank" class="inline-block px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl hover:from-blue-600 hover:to-purple-700 transition-all btn-glow mb-6 font-bold text-xl shadow-lg">üéâ View Your Form</a>
                     <div>
                         <button onclick="closeSuccessModal()" class="px-6 py-3 bg-white/20 text-white rounded-xl hover:bg-white/30 transition-all font-semibold">Close</button>
                     </div>
                 </div>
             </div>
         </div>

         <!-- Welcome Popup -->
         <div id="welcomeModal" class="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 p-4">
             <div class="glass-dark rounded-3xl p-6 sm:p-8 md:p-12 max-w-2xl w-full mx-auto max-h-[90vh] overflow-y-auto">
                 <div class="text-center">
                     <div class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 sm:mb-6 md:mb-8 shadow-2xl">
                         <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                         </svg>
                     </div>
                     <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-white mb-4 sm:mb-6 text-glow">Welcome to Form Builder Pro!</h2>
                     <p class="text-base sm:text-lg md:text-xl text-white/90 mb-6 sm:mb-8 leading-relaxed">The hassle-free Google Form creator powered by AI</p>
                     
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
                         <div class="bg-white/10 rounded-2xl p-4 sm:p-6 border border-white/20">
                             <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4">
                                 <span class="text-white font-bold text-base sm:text-lg">1</span>
                             </div>
                             <h3 class="text-white font-bold text-base sm:text-lg mb-2">Input Heading</h3>
                             <p class="text-white/80 text-xs sm:text-sm">Just enter your form title and let AI do the work</p>
                         </div>
                         <div class="bg-white/10 rounded-2xl p-4 sm:p-6 border border-white/20">
                             <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4">
                                 <span class="text-white font-bold text-base sm:text-lg">2</span>
                             </div>
                             <h3 class="text-white font-bold text-base sm:text-lg mb-2">AI Generates</h3>
                             <p class="text-white/80 text-xs sm:text-sm">AI creates relevant questions with smart options</p>
                         </div>
                         <div class="bg-white/10 rounded-2xl p-4 sm:p-6 border border-white/20">
                             <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4">
                                 <span class="text-white font-bold text-base sm:text-lg">3</span>
                             </div>
                             <h3 class="text-white font-bold text-base sm:text-lg mb-2">Review & Create</h3>
                             <p class="text-white/80 text-xs sm:text-sm">Review, edit if needed, and create instantly</p>
                         </div>
                     </div>
                     
                     <div class="bg-yellow-500/20 border border-yellow-500/30 rounded-2xl p-3 sm:p-4 mb-4 sm:mb-6">
                         <div class="flex items-start space-x-2 sm:space-x-3">
                             <div class="w-5 h-5 sm:w-6 sm:h-6 bg-yellow-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                 <svg class="w-3 h-3 sm:w-4 sm:h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                 </svg>
                             </div>
                             <div>
                                 <h4 class="text-yellow-300 font-semibold text-xs sm:text-sm mb-1">üí° Pro Tip</h4>
                                 <p class="text-yellow-200/90 text-xs sm:text-sm">If you encounter any errors or bugs, simply try again without reloading the page. The AI will generate fresh content each time!</p>
                             </div>
                         </div>
                     </div>
                     
                     <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
                         <button onclick="closeWelcomeModal()" class="px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl hover:from-blue-600 hover:to-purple-700 transition-all btn-glow font-bold text-base sm:text-lg shadow-lg">üöÄ Get Started</button>
                         <button onclick="showTutorial()" class="px-6 sm:px-8 py-3 sm:py-4 bg-white/20 text-white rounded-2xl hover:bg-white/30 transition-all font-bold text-base sm:text-lg">üìñ How It Works</button>
                     </div>
                 </div>
             </div>
         </div>

         <!-- AI Generation Modal -->
         <div id="aiGenerationModal" class="fixed inset-0 bg-black/60 backdrop-blur-md hidden items-center justify-center z-50 p-4">
             <div class="glass-dark rounded-3xl p-6 sm:p-8 md:p-12 max-w-2xl w-full mx-auto max-h-[90vh] overflow-y-auto">
                 <div class="text-center mb-6">
                     <div class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 bg-gradient-to-r from-purple-500 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-2xl">
                         <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                         </svg>
                     </div>
                     <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-white mb-4 text-glow">AI Form Generation</h2>
                     <p class="text-base sm:text-lg md:text-xl text-white/90 mb-6">Customize your AI-generated form</p>
                 </div>

                 <!-- Step 1: Question Count -->
                 <div id="step1" class="mb-6">
                     <h3 class="text-white font-bold text-lg sm:text-xl mb-4">üìä How many questions do you need?</h3>
                     <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4">
                         <button onclick="selectQuestionCount(3)" class="question-count-btn px-4 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 transition-all border border-white/20">3</button>
                         <button onclick="selectQuestionCount(5)" class="question-count-btn px-4 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 transition-all border border-white/20">5</button>
                         <button onclick="selectQuestionCount(8)" class="question-count-btn px-4 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 transition-all border border-white/20">8</button>
                         <button onclick="selectQuestionCount(10)" class="question-count-btn px-4 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 transition-all border border-white/20">10</button>
                     </div>
                     <div class="flex items-center gap-4">
                         <label class="text-white font-medium">Custom:</label>
                         <input type="number" id="customQuestionCount" min="1" max="20" value="5" class="flex-1 px-4 py-2 rounded-xl bg-white/10 text-white border border-white/20 focus:border-purple-400 focus:outline-none">
                     </div>
                 </div>

                 <!-- Step 2: Question Types -->
                 <div id="step2" class="mb-6 hidden">
                     <h3 class="text-white font-bold text-lg sm:text-xl mb-4">üìã Select question types (you can choose multiple)</h3>
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
                         <label class="flex items-center p-3 bg-white/10 rounded-xl border border-white/20 hover:bg-white/20 transition-all cursor-pointer">
                             <input type="checkbox" id="shortAnswer" class="mr-3" checked>
                             <span class="text-white font-medium">Short Answer</span>
                         </label>
                         <label class="flex items-center p-3 bg-white/10 rounded-xl border border-white/20 hover:bg-white/20 transition-all cursor-pointer">
                             <input type="checkbox" id="paragraph" class="mr-3" checked>
                             <span class="text-white font-medium">Paragraph</span>
                         </label>
                         <label class="flex items-center p-3 bg-white/10 rounded-xl border border-white/20 hover:bg-white/20 transition-all cursor-pointer">
                             <input type="checkbox" id="multipleChoice" class="mr-3" checked>
                             <span class="text-white font-medium">Multiple Choice</span>
                         </label>
                         <label class="flex items-center p-3 bg-white/10 rounded-xl border border-white/20 hover:bg-white/20 transition-all cursor-pointer">
                             <input type="checkbox" id="checkboxes" class="mr-3" checked>
                             <span class="text-white font-medium">Checkboxes</span>
                         </label>
                         <label class="flex items-center p-3 bg-white/10 rounded-xl border border-white/20 hover:bg-white/20 transition-all cursor-pointer">
                             <input type="checkbox" id="dropdown" class="mr-3" checked>
                             <span class="text-white font-medium">Dropdown</span>
                         </label>
                     </div>
                     <div class="bg-blue-500/20 border border-blue-500/30 rounded-xl p-3 mb-4">
                         <p class="text-blue-200 text-sm">üí° You can select multiple types. AI will distribute questions across selected types.</p>
                     </div>
                 </div>

                 <!-- Step 3: Generation Summary -->
                 <div id="step3" class="mb-6 hidden">
                     <h3 class="text-white font-bold text-lg sm:text-xl mb-4">üéØ Generation Summary</h3>
                     <div class="bg-white/10 rounded-xl p-4 border border-white/20">
                         <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                             <div>
                                 <h4 class="text-white font-semibold mb-2">üìä Questions:</h4>
                                 <p class="text-white/80">Total: <span id="summaryQuestionCount" class="font-bold">5</span></p>
                                 <p class="text-white/80">Types: <span id="summaryQuestionTypes" class="font-bold">Short Answer, Paragraph, Multiple Choice, Checkboxes, Dropdown</span></p>
                             </div>
                             <div>
                                 <h4 class="text-white font-semibold mb-2">ü§ñ AI Generation:</h4>
                                 <p class="text-white/80">Form Title: <span id="summaryFormTitle" class="font-bold">Your Form Title</span></p>
                                 <p class="text-white/80">Smart distribution across selected types</p>
                             </div>
                         </div>
                     </div>
                 </div>

                 <!-- Navigation Buttons -->
                 <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
                     <button onclick="closeAIGenerationModal()" class="px-6 sm:px-8 py-3 sm:py-4 bg-white/20 text-white rounded-2xl hover:bg-white/30 transition-all font-bold text-base sm:text-lg">‚ùå Cancel</button>
                     <button onclick="previousStep()" id="prevBtn" class="px-6 sm:px-8 py-3 sm:py-4 bg-gray-500 text-white rounded-2xl hover:bg-gray-600 transition-all font-bold text-base sm:text-lg hidden">‚¨ÖÔ∏è Previous</button>
                     <button onclick="nextStep()" id="nextBtn" class="px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl hover:from-purple-600 hover:to-pink-600 transition-all btn-glow font-bold text-base sm:text-lg">Next ‚û°Ô∏è</button>
                     <button onclick="generateFormWithAI()" id="generateBtn" class="px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-2xl hover:from-green-600 hover:to-blue-600 transition-all btn-glow font-bold text-base sm:text-lg hidden">üöÄ Generate Form</button>
                 </div>
             </div>
         </div>

         <!-- CSV Import Modal -->
         <div id="csvImportModal" class="fixed inset-0 bg-black/60 backdrop-blur-md hidden items-center justify-center z-50 p-4">
             <div class="glass-dark rounded-3xl p-6 sm:p-8 md:p-12 max-w-2xl w-full mx-auto max-h-[90vh] overflow-y-auto">
                 <div class="text-center mb-6">
                     <div class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 bg-gradient-to-r from-green-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-2xl">
                         <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                         </svg>
                     </div>
                     <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-white mb-4 text-glow">Import Questions from CSV</h2>
                     <p class="text-base sm:text-lg md:text-xl text-white/90 mb-6">Upload a CSV file with your questions</p>
                 </div>

                 <div class="mb-6">
                     <div class="border-2 border-dashed border-white/30 rounded-xl p-8 text-center hover:border-white/50 transition-all relative">
                         <input type="file" id="csvImportFile" accept=".csv" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                         <div class="text-white/80 relative z-0">
                             <svg class="w-16 h-16 mx-auto mb-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                             </svg>
                             <p class="text-xl font-semibold">Drop your CSV file here</p>
                             <p class="text-sm opacity-75 mb-2">or click to browse</p>
                             <div class="bg-white/10 rounded-lg p-3 mt-4">
                                 <p class="text-sm font-medium">üìã CSV Format:</p>
                                 <p class="text-xs opacity-75">Column 1: Question text</p>
                                 <p class="text-xs opacity-75">Column 2: Question type (optional)</p>
                                 <p class="text-xs opacity-75">Column 3+: Options (optional, comma-separated)</p>
                                 <p class="text-xs opacity-75">Example: "What is your favorite color?", "Multiple Choice", "Red, Blue, Green, Yellow"</p>
                             </div>
                         </div>
                     </div>
                 </div>

                 <div id="csvImportPreview" class="mb-6 hidden">
                     <h3 class="text-white font-bold text-lg mb-4">üìã Preview:</h3>
                     <div id="csvImportQuestionsList" class="bg-white/10 rounded-xl p-4 max-h-48 overflow-y-auto space-y-2"></div>
                     <div class="mt-4 text-center">
                         <p class="text-white/80 text-sm">Found <span id="csvQuestionCount" class="font-bold">0</span> questions</p>
                     </div>
                 </div>

                 <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
                     <button onclick="closeCSVImportModal()" class="px-6 sm:px-8 py-3 sm:py-4 bg-white/20 text-white rounded-2xl hover:bg-white/30 transition-all font-bold text-base sm:text-lg">‚ùå Cancel</button>
                     <button onclick="processCSVImport()" id="processCSVBtn" class="px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-2xl hover:from-green-600 hover:to-teal-700 transition-all btn-glow font-bold text-base sm:text-lg hidden">üì• Import Questions</button>
                 </div>
             </div>
         </div>
    </div>

    <script>
        // Replace with your Google Apps Script Web App URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby56SEBLDNZ6tuZGNNYdQKPVKEwAUf9nEoEeRFUuO_xnnHIP-axbNqWuID2EF0BAFqw_g/exec';
        const GEMINI_API_KEY = 'AIzaSyBWvOxGMQhotE9xibPay49Bm2SnTkrmd0U';
        const GEMINI_MODEL = 'gemini-2.5-pro';
        const GEMINI_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;

        let questions = [];
        let currentOptionMethod = 'manual';
        let aiGenerationStep = 1;
        let selectedQuestionCount = 5;
        let selectedQuestionTypes = ['Short Answer', 'Paragraph', 'Multiple Choice', 'Checkboxes', 'Dropdown'];
        let csvQuestions = [];
        let importedQuestions = [];

        document.getElementById('questionType').addEventListener('change', function() {
            const type = this.value;
            const optionsSection = document.getElementById('optionsSection');
            const paragraphSection = document.getElementById('paragraphSection');
            
            if (['Multiple Choice', 'Checkboxes', 'Dropdown'].includes(type)) {
                optionsSection.classList.remove('hidden');
                paragraphSection.classList.add('hidden');
            } else if (type === 'Paragraph') {
                optionsSection.classList.add('hidden');
                paragraphSection.classList.remove('hidden');
            } else {
                optionsSection.classList.add('hidden');
                paragraphSection.classList.add('hidden');
            }
        });

        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csv = e.target.result;
                    const options = parseCSV(csv);
                    document.getElementById('optionsText').value = options.join('\n');
                };
                reader.readAsText(file);
            }
        });

        function setOptionMethod(method) {
            currentOptionMethod = method;
            document.getElementById('manualBtn').className = method === 'manual' ? 'flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all btn-glow' : 'flex-1 px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all';
            document.getElementById('csvBtn').className = method === 'csv' ? 'flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all btn-glow' : 'flex-1 px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all';
            document.getElementById('aiBtn').className = method === 'ai' ? 'flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all btn-glow' : 'flex-1 px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all';
            
            document.getElementById('manualOptions').classList.toggle('hidden', method !== 'manual');
            document.getElementById('csvOptions').classList.toggle('hidden', method !== 'csv');
            document.getElementById('aiOptions').classList.toggle('hidden', method !== 'ai');
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            return lines.map(line => {
                const firstComma = line.indexOf(',');
                return firstComma > -1 ? line.substring(0, firstComma).trim() : line.trim();
            }).filter(option => option);
        }

        async function callGeminiAPI(prompt) {
            try {
                const response = await fetch(GEMINI_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                } else {
                    throw new Error(`API Error: ${response.status}`);
                }
            } catch (error) {
                console.error('Gemini API Error:', error);
                return 'Error generating content';
            }
        }

        async function generateAIOptions() {
            const questionText = document.getElementById('questionText').value;
            const questionType = document.getElementById('questionType').value;
            const numOptions = document.getElementById('numOptions').value;
            
            if (!questionText.trim()) {
                alert('Please enter question text first');
                return;
            }

            const resultDiv = document.getElementById('aiOptionsResult');
            resultDiv.className = 'mt-3 p-3 bg-white/10 rounded-lg';
            resultDiv.innerHTML = '<div class="text-white">Generating options...</div>';

            const prompt = `Generate ${numOptions} appropriate options for this ${questionType.toLowerCase()} question: "${questionText}"\n\nReturn only the options, one per line, without numbers or bullet points. Make them realistic and relevant to the question.`;
            
            const response = await callGeminiAPI(prompt);
            const options = response.split('\n').filter(line => line.trim()).slice(0, numOptions);
            
            document.getElementById('optionsText').value = options.join('\n');
            resultDiv.innerHTML = `<div class="text-green-400 font-medium">‚úì Generated ${options.length} options</div><div class="text-white/80 text-sm mt-1">${options.join(', ')}</div>`;
        }

        async function generateAIExamples() {
            const questionText = document.getElementById('questionText').value;
            const numExamples = document.getElementById('numExamples').value;
            
            if (!questionText.trim()) {
                alert('Please enter question text first');
                return;
            }

            const resultDiv = document.getElementById('aiExamplesResult');
            resultDiv.className = 'mt-3 p-3 bg-white/10 rounded-lg';
            resultDiv.innerHTML = '<div class="text-white">Generating examples...</div>';

            const prompt = `Generate ${numExamples} realistic example answers for this paragraph question: "${questionText}"\n\nEach example should be 1-3 sentences long and show different ways someone might respond. Return each example on a separate line.`;
            
            const response = await callGeminiAPI(prompt);
            const examples = response.split('\n').filter(line => line.trim()).slice(0, numExamples);
            
            resultDiv.innerHTML = `<div class="text-green-400 font-medium">‚úì Generated ${examples.length} examples</div><div class="text-white/80 text-sm mt-2 space-y-1">${examples.map((ex, i) => `<div><strong>Example ${i+1}:</strong> ${ex}</div>`).join('')}</div>`;
        }

        function addQuestion() {
            const text = document.getElementById('questionText').value.trim();
            const type = document.getElementById('questionType').value;
            
            if (!text) {
                alert('Please enter question text');
                return;
            }

            let options = [];
            if (['Multiple Choice', 'Checkboxes', 'Dropdown'].includes(type)) {
                const optionsText = document.getElementById('optionsText').value.trim();
                if (!optionsText) {
                    alert('Please provide options for choice questions');
                    return;
                }
                options = optionsText.split('\n').map(opt => opt.trim()).filter(opt => opt);
            }

            const question = { text, type, options };
            questions.push(question);
            
            // Show the preview section when first question is added
            if (questions.length === 1) {
                // Change layout to side-by-side
                const formContainer = document.getElementById('formContainer');
                formContainer.className = 'grid grid-cols-1 lg:grid-cols-2 gap-8';
                
                // Adjust main form section to be on the left
                const mainFormSection = document.getElementById('mainFormSection');
                mainFormSection.className = 'w-full';
                
                document.getElementById('formPreviewSection').classList.remove('hidden');
                document.getElementById('createFormSection').classList.remove('hidden');
            }
            
            updatePreview();
            clearQuestionForm();
            
            document.getElementById('createFormSection').classList.remove('hidden');
        }

        function removeQuestion(index) {
            questions.splice(index, 1);
            updatePreview();
            if (questions.length === 0) {
                document.getElementById('formPreviewSection').classList.add('hidden');
                document.getElementById('createFormSection').classList.add('hidden');
                // Return to centered layout
                const formContainer = document.getElementById('formContainer');
                formContainer.className = 'flex justify-center';
                // Reset main form section
                const mainFormSection = document.getElementById('mainFormSection');
                mainFormSection.className = 'w-full max-w-2xl';
            }
        }

        function updatePreview() {
            const preview = document.getElementById('questionsPreview');
            
            if (questions.length === 0) {
                preview.innerHTML = `
                    <div class="text-white/70 text-center py-12">
                        <div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <p class="text-lg font-semibold">No questions added yet</p>
                        <p class="text-sm opacity-75">Add your first question to see the list!</p>
                    </div>
                `;
                return;
            }

            // Simple list of questions
            const questionsHTML = questions.map((q, index) => `
                <div class="bg-white/10 rounded-xl p-4 border border-white/10 hover:border-white/20 transition-all mb-4">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <div class="w-6 h-6 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3">
                                    <span class="text-white font-bold text-xs">${index + 1}</span>
                                </div>
                                <h4 class="text-white font-semibold text-base">${q.text}</h4>
                            </div>
                            <div class="flex items-center space-x-3 mb-2">
                                <span class="px-2 py-1 bg-white/20 text-white rounded-full text-xs font-medium">${q.type}</span>
                                ${q.options.length > 0 ? `<span class="text-white/60 text-xs">${q.options.length} options</span>` : ''}
                            </div>
                            ${q.options.length > 0 ? `
                                <div class="bg-white/5 rounded-lg p-3">
                                    <p class="text-white/70 text-xs font-medium mb-2">Options:</p>
                                    <div class="flex flex-wrap gap-1">
                                        ${q.options.map(option => `<span class="px-2 py-1 bg-white/10 text-white rounded text-xs">${option}</span>`).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        <button onclick="removeQuestion(${index})" class="text-red-400 hover:text-red-300 transition-colors ml-2 p-1 hover:bg-red-500/20 rounded-lg">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');

            preview.innerHTML = questionsHTML;
        }

        function clearQuestionForm() {
            document.getElementById('questionText').value = '';
            document.getElementById('optionsText').value = '';
            document.getElementById('csvFile').value = '';
            document.getElementById('aiOptionsResult').innerHTML = '';
            document.getElementById('aiExamplesResult').innerHTML = '';
            document.getElementById('questionType').value = 'Short Answer';
            document.getElementById('optionsSection').classList.add('hidden');
            document.getElementById('paragraphSection').classList.add('hidden');
        }



        function clearForm() {
            clearQuestionForm();
            document.getElementById('formTitle').value = '';
            questions = [];
            updatePreview();
            document.getElementById('formPreviewSection').classList.add('hidden');
            document.getElementById('createFormSection').classList.add('hidden');
            // Return to centered layout
            const formContainer = document.getElementById('formContainer');
            formContainer.className = 'flex justify-center';
            // Reset main form section
            const mainFormSection = document.getElementById('mainFormSection');
            mainFormSection.className = 'w-full max-w-2xl';
        }

        // Fixed CORS issue by using GET request with parameters instead of POST
        async function createGoogleForm() {
            const title = document.getElementById('formTitle').value.trim();
            
            if (!title) {
                alert('Please enter a form title');
                return;
            }
            
            if (questions.length === 0) {
                alert('Please add at least one question');
                return;
            }

            document.getElementById('loadingModal').classList.remove('hidden');
            document.getElementById('loadingModal').classList.add('flex');

            try {
                // Use GET request with URL parameters to avoid CORS issues
                const params = new URLSearchParams({
                    title: title,
                    questions: JSON.stringify(questions)
                });

                const response = await fetch(`${GOOGLE_SCRIPT_URL}?${params.toString()}`, {
                    method: 'GET'
                });

                const result = await response.json();
                
                document.getElementById('loadingModal').classList.add('hidden');
                document.getElementById('loadingModal').classList.remove('flex');

                if (result.success) {
                    document.getElementById('formLink').href = result.formUrl;
                    document.getElementById('successModal').classList.remove('hidden');
                    document.getElementById('successModal').classList.add('flex');
                } else {
                    alert('Failed to create form: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                document.getElementById('loadingModal').classList.add('hidden');
                document.getElementById('loadingModal').classList.remove('flex');
                alert('Network error: ' + error.message);
            }
        }

        // AI Generation Modal Functions
        function showAIGenerationModal() {
            const formTitle = document.getElementById('formTitle').value.trim();
            
            if (!formTitle) {
                alert('Please enter a form title first');
                return;
            }
            
            // Check if there are existing questions
            const hasExistingQuestions = questions.length > 0;
            
            document.getElementById('aiGenerationModal').classList.remove('hidden');
            document.getElementById('aiGenerationModal').classList.add('flex');
            resetAIGenerationModal();
            
            // Update modal title and description if adding to existing questions
            if (hasExistingQuestions) {
                document.querySelector('#aiGenerationModal h2').textContent = 'Add More Questions';
                document.querySelector('#aiGenerationModal p').textContent = `Add ${selectedQuestionCount} more questions to your existing ${questions.length} questions`;
            } else {
                document.querySelector('#aiGenerationModal h2').textContent = 'AI Form Generation';
                document.querySelector('#aiGenerationModal p').textContent = 'Customize your AI-generated form';
            }
        }

        function closeAIGenerationModal() {
            document.getElementById('aiGenerationModal').classList.add('hidden');
            document.getElementById('aiGenerationModal').classList.remove('flex');
        }

        function resetAIGenerationModal() {
            aiGenerationStep = 1;
            selectedQuestionCount = 5;
            selectedQuestionTypes = ['Short Answer', 'Paragraph', 'Multiple Choice', 'Checkboxes', 'Dropdown'];
            
            // Reset UI
            document.getElementById('customQuestionCount').value = '5';
            document.querySelectorAll('.question-count-btn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'border-purple-400');
                btn.classList.add('bg-white/10', 'border-white/20');
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
            
            showStep(1);
        }

        function selectQuestionCount(count) {
            selectedQuestionCount = count;
            document.getElementById('customQuestionCount').value = count;
            
            // Update button styles
            document.querySelectorAll('.question-count-btn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'border-purple-400');
                btn.classList.add('bg-white/10', 'border-white/20');
            });
            event.target.classList.remove('bg-white/10', 'border-white/20');
            event.target.classList.add('bg-purple-500', 'border-purple-400');
        }

        function nextStep() {
            if (aiGenerationStep === 1) {
                // Validate question count
                const customCount = parseInt(document.getElementById('customQuestionCount').value);
                if (customCount < 1 || customCount > 20) {
                    alert('Please enter a valid number between 1 and 20');
                    return;
                }
                selectedQuestionCount = customCount;
                showStep(2);
            } else if (aiGenerationStep === 2) {
                // Validate question types
                const checkedTypes = [];
                if (document.getElementById('shortAnswer').checked) checkedTypes.push('Short Answer');
                if (document.getElementById('paragraph').checked) checkedTypes.push('Paragraph');
                if (document.getElementById('multipleChoice').checked) checkedTypes.push('Multiple Choice');
                if (document.getElementById('checkboxes').checked) checkedTypes.push('Checkboxes');
                if (document.getElementById('dropdown').checked) checkedTypes.push('Dropdown');
                
                if (checkedTypes.length === 0) {
                    alert('Please select at least one question type');
                    return;
                }
                selectedQuestionTypes = checkedTypes;
                updateSummaryStep();
                showStep(3);
            }
        }

        function previousStep() {
            if (aiGenerationStep > 1) {
                showStep(aiGenerationStep - 1);
            }
        }

        function showStep(step) {
            aiGenerationStep = step;
            
            // Hide all steps
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            
            // Show current step
            document.getElementById(`step${step}`).classList.remove('hidden');
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const generateBtn = document.getElementById('generateBtn');
            
            if (step === 1) {
                prevBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
                generateBtn.classList.add('hidden');
            } else if (step === 2) {
                prevBtn.classList.remove('hidden');
                nextBtn.classList.remove('hidden');
                generateBtn.classList.add('hidden');
            } else if (step === 3) {
                prevBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden');
                generateBtn.classList.remove('hidden');
            }
        }

        function updateSummaryStep() {
            const formTitle = document.getElementById('formTitle').value.trim();
            document.getElementById('summaryQuestionCount').textContent = selectedQuestionCount;
            document.getElementById('summaryQuestionTypes').textContent = selectedQuestionTypes.join(', ');
            document.getElementById('summaryFormTitle').textContent = formTitle || 'Your Form Title';
        }

        // CSV Questions Import (for options)
        document.getElementById('csvQuestionsFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csv = e.target.result;
                    csvQuestions = parseCSVQuestions(csv);
                    showCSVPreview();
                };
                reader.readAsText(file);
            }
        });

        function parseCSVQuestions(csv) {
            const lines = csv.trim().split('\n');
            return lines.map(line => {
                const columns = line.split(',').map(col => col.trim().replace(/^["']|["']$/g, ''));
                
                if (columns.length === 0 || !columns[0]) return null;
                
                const question = {
                    text: columns[0],
                    type: columns[1] || 'Short Answer',
                    options: []
                };
                
                // Parse options from remaining columns
                if (columns.length > 2) {
                    const optionsString = columns.slice(2).join(',');
                    question.options = optionsString.split(',').map(opt => opt.trim()).filter(opt => opt);
                }
                
                return question;
            }).filter(question => question);
        }

        function showCSVPreview() {
            const preview = document.getElementById('csvPreview');
            const list = document.getElementById('csvQuestionsList');
            
            if (csvQuestions.length > 0) {
                list.innerHTML = csvQuestions.map((q, i) => 
                    `<div class="text-white/90 text-sm mb-1">${i + 1}. ${q}</div>`
                ).join('');
                preview.classList.remove('hidden');
            } else {
                preview.classList.add('hidden');
            }
        }

        // CSV Import Functions
        function showCSVImportModal() {
            document.getElementById('csvImportModal').classList.remove('hidden');
            document.getElementById('csvImportModal').classList.add('flex');
            resetCSVImportModal();
        }

        function closeCSVImportModal() {
            document.getElementById('csvImportModal').classList.add('hidden');
            document.getElementById('csvImportModal').classList.remove('flex');
        }

        function resetCSVImportModal() {
            importedQuestions = [];
            document.getElementById('csvImportFile').value = '';
            document.getElementById('csvImportPreview').classList.add('hidden');
            document.getElementById('processCSVBtn').classList.add('hidden');
        }

        // CSV Import File Handler
        document.getElementById('csvImportFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csv = e.target.result;
                    importedQuestions = parseCSVQuestions(csv);
                    showCSVImportPreview();
                };
                reader.readAsText(file);
            }
        });

        // Prevent file input from interfering with modal buttons
        document.getElementById('csvImportModal').addEventListener('click', function(e) {
            // If clicking on buttons or outside the file upload area, don't trigger file input
            if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                e.stopPropagation();
                return;
            }
        });

        function showCSVImportPreview() {
            const preview = document.getElementById('csvImportPreview');
            const list = document.getElementById('csvImportQuestionsList');
            const count = document.getElementById('csvQuestionCount');
            
            if (importedQuestions.length > 0) {
                list.innerHTML = importedQuestions.map((q, i) => {
                    const optionsText = q.options && q.options.length > 0 ? ` (${q.options.length} options)` : '';
                    return `<div class="text-white/90 text-sm p-2 bg-white/5 rounded-lg">
                        <div class="font-semibold">${i + 1}. ${q.text}</div>
                        <div class="text-xs opacity-75">Type: ${q.type}${optionsText}</div>
                        ${q.options && q.options.length > 0 ? `<div class="text-xs opacity-60 mt-1">Options: ${q.options.join(', ')}</div>` : ''}
                    </div>`;
                }).join('');
                count.textContent = importedQuestions.length;
                preview.classList.remove('hidden');
                document.getElementById('processCSVBtn').classList.remove('hidden');
            } else {
                preview.classList.add('hidden');
                document.getElementById('processCSVBtn').classList.add('hidden');
            }
        }

        function processCSVImport() {
            if (importedQuestions.length === 0) {
                alert('No questions to import');
                return;
            }

            // Add all imported questions with their types and options
            importedQuestions.forEach(question => {
                questions.push({
                    text: question.text,
                    type: question.type,
                    options: question.options || []
                });
            });

            // Show the preview section when questions are imported
            // Change layout to side-by-side
            const formContainer = document.getElementById('formContainer');
            formContainer.className = 'grid grid-cols-1 lg:grid-cols-2 gap-8';
            
            // Adjust main form section to be on the left
            const mainFormSection = document.getElementById('mainFormSection');
            mainFormSection.className = 'w-full';
            
            document.getElementById('formPreviewSection').classList.remove('hidden');
            document.getElementById('createFormSection').classList.remove('hidden');
            
            updatePreview();
            document.getElementById('createFormSection').classList.remove('hidden');
            
            // Show success message
            alert(`Successfully imported ${importedQuestions.length} questions!`);
            
            // Close modal
            closeCSVImportModal();
        }

        function importQuestionsFromCSV() {
            // This function is called from the inline preview
            if (importedQuestions.length === 0) {
                alert('No questions to import');
                return;
            }

            processCSVImport();
        }

        async function generateFormWithAI() {
            const formTitle = document.getElementById('formTitle').value.trim();
            
            if (!formTitle) {
                alert('Please enter a form title first');
                return;
            }

            // Close modal and show loading
            closeAIGenerationModal();
            document.getElementById('loadingModal').classList.remove('hidden');
            document.getElementById('loadingModal').classList.add('flex');

            try {
                // Build prompt based on user selections
                let prompt = `Generate a Google Form for: "${formTitle}"\n\n`;
                prompt += `Create exactly ${selectedQuestionCount} questions with the following types: ${selectedQuestionTypes.join(', ')}\n\n`;
                prompt += `Distribute the questions evenly across the selected types. For choice-based questions (Multiple Choice, Checkboxes, Dropdown), include 3-5 realistic options.\n\n`;
                prompt += `IMPORTANT: Return ONLY valid JSON in this exact format, no additional text:
{
  "title": "Form Title",
  "questions": [
    {
      "text": "Question text here",
      "type": "Short Answer",
      "options": []
    },
    {
      "text": "Question text here", 
      "type": "Multiple Choice",
      "options": ["Option 1", "Option 2", "Option 3"]
    }
  ]
}

For choice-based questions (Multiple Choice, Checkboxes, Dropdown), always include options array.
For text questions (Short Answer, Paragraph), use empty options array: []`;

                const response = await callGeminiAPI(prompt);
                
                // Try to parse the JSON response
                let formData;
                try {
                    formData = JSON.parse(response);
                } catch (parseError) {
                    // Try to extract JSON from the response if it contains extra text
                    const jsonMatch = response.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        try {
                            formData = JSON.parse(jsonMatch[0]);
                        } catch (secondError) {
                            throw parseError; // Use original error
                        }
                    } else {
                        throw parseError;
                    }
                }
                
                try {
                    if (formData.title && formData.questions && Array.isArray(formData.questions)) {
                        const existingQuestionsCount = questions.length;
                        
                        // Add the AI-generated questions (don't clear existing ones)
                        formData.questions.forEach(q => {
                            if (q.text && q.type) {
                                questions.push({
                                    text: q.text,
                                    type: q.type,
                                    options: q.options || []
                                });
                            }
                        });
                        
                        // Update form title if provided and no existing title
                        if (formData.title && !document.getElementById('formTitle').value.trim()) {
                            document.getElementById('formTitle').value = formData.title;
                        }
                        
                        // Show the preview section when AI generates questions
                        // Change layout to side-by-side
                        const formContainer = document.getElementById('formContainer');
                        formContainer.className = 'grid grid-cols-1 lg:grid-cols-2 gap-8';
                        
                        // Adjust main form section to be on the left
                        const mainFormSection = document.getElementById('mainFormSection');
                        mainFormSection.className = 'w-full';
                        
                        document.getElementById('formPreviewSection').classList.remove('hidden');
                        document.getElementById('createFormSection').classList.remove('hidden');
                        
                        updatePreview();
                        document.getElementById('createFormSection').classList.remove('hidden');
                        
                        const newQuestionsCount = questions.length - existingQuestionsCount;
                        if (existingQuestionsCount > 0) {
                            alert(`Successfully added ${newQuestionsCount} more questions! Total: ${questions.length} questions`);
                        } else {
                            alert(`Successfully generated ${questions.length} questions with AI!`);
                        }
                    } else {
                        throw new Error('Invalid response format');
                    }
                } catch (parseError) {
                    console.error('Failed to parse AI response:', response);
                    console.error('Parse error:', parseError);
                    alert('AI generated content, but it wasn\'t in the expected JSON format. The response was:\n\n' + response.substring(0, 200) + '...\n\nPlease try again.');
                }
                
            } catch (error) {
                console.error('AI Form Generation Error:', error);
                alert('Failed to generate form with AI: ' + error.message);
            } finally {
                // Hide loading modal
                document.getElementById('loadingModal').classList.add('hidden');
                document.getElementById('loadingModal').classList.remove('flex');
            }
        }

                 function closeSuccessModal() {
             document.getElementById('successModal').classList.add('hidden');
             document.getElementById('successModal').classList.remove('flex');
             clearForm();
         }

         function closeWelcomeModal() {
             document.getElementById('welcomeModal').classList.add('hidden');
             document.getElementById('welcomeModal').classList.remove('flex');
         }

         function showTutorial() {
             // Show a simple tutorial alert for now
             alert('üéØ How to use Form Builder Pro:\n\n1. Enter your form title\n2. Click "Generate Form with AI" to create questions automatically\n3. Review and edit the generated questions if needed\n4. Click "Create Google Form" to generate your form\n\nThat\'s it! No manual question creation needed!');
         }

        setOptionMethod('manual');
        
        // Particle Effect
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 30 + 's';
                particle.style.animationDuration = (Math.random() * 15 + 20) + 's';
                particle.style.opacity = Math.random() * 0.3 + 0.05;
                particlesContainer.appendChild(particle);
            }
        }
        
                 // Initialize particles when page loads
         document.addEventListener('DOMContentLoaded', function() {
             createParticles();
             
             // Show welcome modal on first visit
             const hasVisited = localStorage.getItem('formBuilderVisited');
             if (!hasVisited) {
                 document.getElementById('welcomeModal').classList.remove('hidden');
                 document.getElementById('welcomeModal').classList.add('flex');
                 localStorage.setItem('formBuilderVisited', 'true');
             }
             
             // Mobile optimizations
             if (window.innerWidth <= 768) {
                 // Reduce particle count on mobile for better performance
                 const particles = document.querySelectorAll('.particle');
                 particles.forEach((particle, index) => {
                     if (index > 10) particle.remove();
                 });
                 
                 // Add touch-friendly interactions
                 document.querySelectorAll('button').forEach(button => {
                     button.addEventListener('touchstart', function() {
                         this.style.transform = 'scale(0.95)';
                     });
                     button.addEventListener('touchend', function() {
                         this.style.transform = '';
                     });
                 });
             }
         });
    </script>
</body>
</html>